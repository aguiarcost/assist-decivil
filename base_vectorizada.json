import json
import openai
from tqdm import tqdm

# Lê chave da API de forma segura (se preferires podes usar diretamente st.secrets)
openai.api_key = "A_TUA_CHAVE_AQUI"

def gerar_embedding(texto):
    response = openai.embeddings.create(
        input=texto,
        model="text-embedding-3-small"
    )
    return response.data[0].embedding

# Lê base original
with open("base_conhecimento.json", "r", encoding="utf-8") as f:
    dados = json.load(f)

# Gera embeddings
base_vectorizada = []
for entrada in tqdm(dados):
    texto = entrada.get("texto", "").strip()
    if texto:
        embedding = gerar_embedding(texto)
        base_vectorizada.append({
            "texto": texto,
            "embedding": embedding
        })

# Guarda nova base com embeddings
with open("base_vectorizada.json", "w", encoding="utf-8") as f:
    json.dump(base_vectorizada, f, ensure_ascii=False, indent=2)

print("✅ base_vectorizada.json criado com sucesso.")
